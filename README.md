# TYPO3 Docker


## What is this?

Yet another TYPO3 CMS Docker package based upon PHP and Apache. It's simple, understandable and yet fully functional.

_Suitable for development and production._


**What is included?**

* A minimal production image
* A TYPO3 CMS "Introduction package" image
* A development image with
    * Xdebug
    * Mailhog
    * Adminer
    * Ruby
    * SASS
    * Node.js (npm)
* A simple way to create an image for your custom project


## Usage

_Note:_ We need to build the base image first so the dev and demo image can extend (`FROM`) it.


**Prod**

Build and run a minimal production / base image:

```
docker-compose build
```
This will create the `typo3.webserver` image.

**Dev**

Build and run an image with development tools (composer, xdebug, etc.):

```
docker-compose build
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
```

Default domain is [http://dev.typo3.vm]()

**Demo**

Build and run an image with installed and fully functional introduction package:

```
docker-compose build
docker-compose -f docker-compose.yml -f docker-compose.demo.yml up --build -d
```

Use the following command to install the introduction package using TYPO3 console:

```
docker-compose exec webserver /bin/bash ./install.sh
```

Default domain is [http://demo.typo3.vm]()


### Use with existing projects

**Project requirements**

* A GIT repository for your project
* A `composer` based TYPO3 project
* Using `/web` folder for all public files (using the `web-dir` directive, see composer.json in `/demo` folder)
* Make sure your project composer file contains `helhum/typo3-console` as a dependency

**How to integrate with your existing TYPO3 CMS project**

* Clone this repository to `.docker` sub folder of your project
* Copy the `.env` file to your project root folder and change variables as needed
* Run the following commands:

```
cd .docker
docker-compose build
cd ..
docker-compose -f .docker/docker-compose.yml -f .docker/docker-compose.project.yml up --build -d
```

**This will:**

* Create production image with web server and database
* Install your composer dependencies
* Add your local `web` files

Use the following command to import your static files to the volume:

```
docker cp ./web/fileadmin docker_webserver:/var/www/project/
docker cp ./web/uploads docker_webserver:/var/www/project/
```

Use the following command to import your database:

```
docker cp .docker/project/data docker_webserver:/var/www/project/
docker-compose exec docker_webserver gunzip < /var/www/project/data/import.sql.gz | php /var/www/html/vendor/bin/typo3cms database:import
```

_Note:_ You will need to add your `import.sql.gz` to `.docker/project/data`, so the file is available.
_Note:_ You might need to copy your `PackageStates.php` file if auto generated by composer scripts.


### Database credentials

Default values for the database connection are:

User: `dbname`
Pass: `dbpass`
Host: `db`
Port: `3306`

_Some of those can be changed in the `.env` file._


### Change PHP version

Change the PHP version by using:

```
docker-compose -f docker-compose.yml -f docker-compose.php.7.0.yml build
docker-compose -f docker-compose.yml -f docker-compose.php.7.0.yml -f docker-compose.demo.yml up --build -d
```


## Issues

* Fixed dependency issue with latest TYPO3 version in composer.json 


## Credits

Thanks to @jzaefferer (@sloppyio) for the help getting started with docker!

**Resources**

* https://github.com/sloppyio/quickstarters
* https://github.com/docker-library/wordpress
* https://github.com/t3easy/docker-typo3
* https://writing.pupius.co.uk/apache-and-php-on-docker-44faef716150
